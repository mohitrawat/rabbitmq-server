# https://help.github.com/en/actions/configuring-and-managing-workflows/configuring-a-workflow
name: OTP v22.3
on: push
jobs:
  checks:
    name: checks
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CHECK RABBITMQ COMPONENTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          make check-rabbitmq-components.mk base_rmq_ref=master current_rmq_ref=$branch_or_tag_name
      - name: CHECK SCRIPTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          make bats base_rmq_ref=master current_rmq_ref=$branch_or_tag_name
      # https://help.github.com/en/actions/configuring-and-managing-workflows/caching-dependencies-to-speed-up-workflows
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: RESOLVE & COMPILE DEPS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          make deps test-deps base_rmq_ref=master current_rmq_ref=$branch_or_tag_name
          echo "Remove directories not used in the subsequent jobs..."
          rm -fr deps/*/{.git,test}
          echo "Symlink rabbit dep to rabbitmq-server to address the hard-coding in install-cli-scripts make target..."
          ln -s deps/rabbit ../
      - name: GENERATE DEPS VERSIONS
        run: |
          make rabbitmq-server-tested-deps.mk
      - name: UPLOAD DEPS VERSIONS
        uses: actions/upload-artifact@v2-preview
        with:
          name: rabbitmq-server-tested-deps.mk
          path: rabbitmq-server-tested-deps.mk
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: CHECK CROSS REFERENCES
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          make xref base_rmq_ref=master current_rmq_ref=$branch_or_tag_named
      - name: COMPILE FOR TEST
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          make test-build base_rmq_ref=master current_rmq_ref=$branch_or_tag_named
  eunit:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: eunit
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make eunit base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
# To find what ct suites we need to add & in which order:
# ls test/*SUITE.erl | sort
  ct-amqqueue_backward_compatibility:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-amqqueue_backward_compatibility
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-amqqueue_backward_compatibility base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-amqqueue_backward_compatibility-logs
          path: "*-ct-logs-*.tar.xz"
  ct-backing_queue:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-backing_queue
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-backing_queue base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-backing_queue-logs
          path: "*-ct-logs-*.tar.gz"
  ct-channel_interceptor:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-channel_interceptor
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-channel_interceptor base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-channel_interceptor-logs
          path: "*-ct-logs-*.tar.xz"
  ct-channel_operation_timeout:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-channel_operation_timeout
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-channel_operation_timeout base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-channel_operation_timeout-logs
          path: "*-ct-logs-*.tar.xz"
  ct-cluster:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-cluster
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-cluster base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-cluster-logs
          path: "*-ct-logs-*.tar.xz"
  ct-cluster_rename:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-cluster_rename
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-cluster_rename base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-cluster_rename-logs
          path: "*-ct-logs-*.tar.xz"
  ct-clustering_management_clustered_2_nodes:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-clustering_management_clustered_2_nodes
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-clustering_management t=clustered_2_nodes base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-clustering_management_clustered_2_nodes-logs
          path: "*-ct-logs-*.tar.xz"
  ct-clustering_management_clustered_4_nodes:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-clustering_management_clustered_4_nodes
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-clustering_management t=clustered_4_nodes base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-clustering_management_clustered_4_nodes-logs
          path: "*-ct-logs-*.tar.xz"
  ct-clustering_management_unclustered_2_nodes:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-clustering_management_unclustered_2_nodes
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-clustering_management t=unclustered_2_nodes base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-clustering_management_unclustered_2_nodes-logs
          path: rabbit-ct-logs-*.tar.xz
  ct-clustering_management_unclustered_3_nodes:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-clustering_management_unclustered_3_nodes
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-clustering_management t=unclustered_3_nodes base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-clustering_management_unclustered_3_nodes-logs
          path: "*-ct-logs-*.tar.xz"
  ct-config_schema:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-config_schema
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-config_schema base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-config_schema-logs
          path: "*-ct-logs-*.tar.xz"
  ct-confirms_rejects:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-confirms_rejects
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-confirms_rejects base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-confirms_rejects-logs
          path: "*-ct-logs-*.tar.xz"
  ct-consumer_timeout:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-consumer_timeout
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-consumer_timeout base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-consumer_timeout-logs
          path: "*-ct-logs-*.tar.xz"
  ct-crashing_queues:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-crashing_queues
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-crashing_queues base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-crashing_queues-logs
          path: "*-ct-logs-*.tar.xz"
  ct-dead_lettering:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-dead_lettering
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-dead_lettering base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-dead_lettering-logs
          path: "*-ct-logs-*.tar.xz"
  ct-definition_import:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-definition_import
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-definition_import base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-definition_import-logs
          path: "*-ct-logs-*.tar.xz"
  ct-disconnect_detected_during_alarm:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-disconnect_detected_during_alarm
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-disconnect_detected_during_alarm base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-disconnect_detected_during_alarm-logs
          path: "*-ct-logs-*.tar.xz"
  ct-dynamic_ha:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-dynamic_ha
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-dynamic_ha base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-dynamic_ha-logs
          path: "*-ct-logs-*.tar.xz"
  ct-dynamic_qq:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-dynamic_qq
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-dynamic_qq base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-dynamic_qq-logs
          path: "*-ct-logs-*.tar.xz"
  ct-eager_sync:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-eager_sync
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-eager_sync base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-eager_sync-logs
          path: "*-ct-logs-*.tar.xz"
  ct-feature_flags:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-feature_flags
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-feature_flags base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-feature_flags-logs
          path: "*-ct-logs-*.tar.xz"
  ct-health_check:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-health_check
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-health_check base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-health_check-logs
          path: "*-ct-logs-*.tar.xz"
  ct-lazy_queue:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-lazy_queue
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-lazy_queue base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-lazy_queue-logs
          path: "*-ct-logs-*.tar.xz"
  ct-list_consumers_sanity_check:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-list_consumers_sanity_check
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-list_consumers_sanity_check base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-list_consumers_sanity_check-logs
          path: "*-ct-logs-*.tar.xz"
  ct-list_queues_online_and_offline:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-list_queues_online_and_offline
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-list_queues_online_and_offline base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-list_queues_online_and_offline-logs
          path: "*-ct-logs-*.tar.xz"
  ct-many_node_ha:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-many_node_ha
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-many_node_ha base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-many_node_ha-logs
          path: "*-ct-logs-*.tar.xz"
  ct-message_size_limit:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-message_size_limit
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-message_size_limit base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-message_size_limit-logs
          path: "*-ct-logs-*.tar.xz"
  ct-metrics:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-metrics
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-metrics base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-metrics-logs
          path: "*-ct-logs-*.tar.xz"
  ct-mirrored_supervisor:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-mirrored_supervisor
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-mirrored_supervisor base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-mirrored_supervisor-logs
          path: "*-ct-logs-*.tar.xz"
  ct-msg_store:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-msg_store
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-msg_store base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-msg_store-logs
          path: "*-ct-logs-*.tar.xz"
  ct-peer_discovery_classic_config:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-peer_discovery_classic_config
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-peer_discovery_classic_config base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-peer_discovery_classic_config-logs
          path: "*-ct-logs-*.tar.xz"
  ct-peer_discovery_dns:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-peer_discovery_dns
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-peer_discovery_dns base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-peer_discovery_dns-logs
          path: "*-ct-logs-*.tar.xz"
  ct-per_user_connection_tracking:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-per_user_connection_tracking
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-per_user_connection_tracking base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-per_user_connection_tracking-logs
          path: "*-ct-logs-*.tar.xz"
  ct-per_vhost_connection_limit:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-per_vhost_connection_limit
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-per_vhost_connection_limit base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-per_vhost_connection_limit-logs
          path: "*-ct-logs-*.tar.xz"
  ct-per_vhost_connection_limit_partitions:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-per_vhost_connection_limit_partitions
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-per_vhost_connection_limit_partitions base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-per_vhost_connection_limit_partitions-logs
          path: "*-ct-logs-*.tar.xz"
  ct-per_vhost_msg_store:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-per_vhost_msg_store
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-per_vhost_msg_store base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-per_vhost_msg_store-logs
          path: "*-ct-logs-*.tar.xz"
  ct-per_vhost_queue_limit:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-per_vhost_queue_limit
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-per_vhost_queue_limit base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-per_vhost_queue_limit-logs
          path: "*-ct-logs-*.tar.xz"
  ct-policy:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-policy
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-policy base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-policy-logs
          path: "*-ct-logs-*.tar.xz"
  ct-priority_queue:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-priority_queue
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-priority_queue base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-priority_queue-logs
          path: "*-ct-logs-*.tar.xz"
  ct-priority_queue_recovery:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-priority_queue_recovery
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-priority_queue_recovery base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-priority_queue_recovery-logs
          path: "*-ct-logs-*.tar.xz"
  ct-product_info:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-product_info
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-product_info base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-product_info-logs
          path: "*-ct-logs-*.tar.xz"
  ct-proxy_protocol:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-proxy_protocol
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-proxy_protocol base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-proxy_protocol-logs
          path: "*-ct-logs-*.tar.xz"
  ct-publisher_confirms_parallel:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-publisher_confirms_parallel
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-publisher_confirms_parallel base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-publisher_confirms_parallel-logs
          path: "*-ct-logs-*.tar.xz"
  ct-queue_length_limits:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-queue_length_limits
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-queue_length_limits base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-queue_length_limits-logs
          path: "*-ct-logs-*.tar.xz"
  ct-queue_master_location:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-queue_master_location
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-queue_master_location base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-queue_master_location-logs
          path: "*-ct-logs-*.tar.xz"
  ct-queue_parallel:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-queue_parallel
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-queue_parallel base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-queue_parallel-logs
          path: "*-ct-logs-*.tar.xz"
  ct-quorum_queue:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-quorum_queue
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-quorum_queue base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-quorum_queue-logs
          path: "*-ct-logs-*.tar.xz"
  ct-rabbit_core_metrics_gc:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-rabbit_core_metrics_gc
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-rabbit_core_metrics_gc base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-rabbit_core_metrics_gc-logs
          path: "*-ct-logs-*.tar.xz"
  ct-rabbit_fifo:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-rabbit_fifo
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-rabbit_fifo base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-rabbit_fifo-logs
          path: "*-ct-logs-*.tar.xz"
  ct-rabbit_fifo_int:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-rabbit_fifo_int
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-rabbit_fifo_int base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-rabbit_fifo_int-logs
          path: "*-ct-logs-*.tar.xz"
  ct-rabbit_fifo_prop:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-rabbit_fifo_prop
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-rabbit_fifo_prop base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-rabbit_fifo_prop-logs
          path: "*-ct-logs-*.tar.xz"
  ct-rabbitmq_queues_cli_integration:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-rabbitmq_queues_cli_integration
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-rabbitmq_queues_cli_integration base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-rabbitmq_queues_cli_integration-logs
          path: "*-ct-logs-*.tar.xz"
  ct-rabbitmqctl_integration:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-rabbitmqctl_integration
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-rabbitmqctl_integration base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-rabbitmqctl_integration-logs
          path: "*-ct-logs-*.tar.xz"
  ct-rabbitmqctl_shutdown:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-rabbitmqctl_shutdown
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-rabbitmqctl_shutdown base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-rabbitmqctl_shutdown-logs
          path: "*-ct-logs-*.tar.xz"
  ct-signal_handling:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-signal_handling
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-signal_handling base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-signal_handling-logs
          path: "*-ct-logs-*.tar.xz"
  ct-simple_ha:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-simple_ha
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-simple_ha base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-simple_ha-logs
          path: "*-ct-logs-*.tar.xz"
  ct-single_active_consumer:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-single_active_consumer
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-single_active_consumer base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-single_active_consumer-logs
          path: "*-ct-logs-*.tar.xz"
  ct-sup_delayed_restart:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-sup_delayed_restart
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-sup_delayed_restart base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-sup_delayed_restart-logs
          path: "*-ct-logs-*.tar.xz"
  ct-sync_detection:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-sync_detection
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-sync_detection base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-sync_detection-logs
          path: "*-ct-logs-*.tar.xz"
  ct-term_to_binary_compat_prop:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-term_to_binary_compat_prop
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-term_to_binary_compat_prop base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-term_to_binary_compat_prop-logs
          path: "*-ct-logs-*.tar.xz"
  ct-topic_permission:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-topic_permission
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-topic_permission base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-topic_permission-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_access_control:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_access_control
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_access_control base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_access_control-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_access_control_authn_authz_context_propagation:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_access_control_authn_authz_context_propagation
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_access_control_authn_authz_context_propagation base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_access_control_authn_authz_context_propagation-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_access_control_credential_validation:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_access_control_credential_validation
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_access_control_credential_validation base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_access_control_credential_validation-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_amqp091_content_framing:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_amqp091_content_framing
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_amqp091_content_framing base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_amqp091_content_framing-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_amqp091_server_properties:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_amqp091_server_properties
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_amqp091_server_properties base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_amqp091_server_properties-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_app_management:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_app_management
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_app_management base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_app_management-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_cluster_formation_locking_mocks:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_cluster_formation_locking_mocks
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_cluster_formation_locking_mocks base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_cluster_formation_locking_mocks-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_collections:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_collections
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_collections base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_collections-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_config_value_encryption:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_config_value_encryption
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_config_value_encryption base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_config_value_encryption-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_connection_tracking:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_connection_tracking
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_connection_tracking base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_connection_tracking-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_credit_flow:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_credit_flow
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_credit_flow base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_credit_flow-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_disk_monitor:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_disk_monitor
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_disk_monitor base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_disk_monitor-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_disk_monitor_mocks:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_disk_monitor_mocks
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_disk_monitor_mocks base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_disk_monitor_mocks-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_file_handle_cache:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_file_handle_cache
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_file_handle_cache base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_file_handle_cache-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_gen_server2:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_gen_server2
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_gen_server2 base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_gen_server2-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_gm:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_gm
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_gm base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_gm-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_log_config:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_log_config
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_log_config base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_log_config-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_log_management:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_log_management
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_log_management base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_log_management-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_operator_policy:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_operator_policy
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_operator_policy base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_operator_policy-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_pg_local:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_pg_local
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_pg_local base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_pg_local-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_plugin_directories:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_plugin_directories
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_plugin_directories base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_plugin_directories-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_plugin_versioning:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_plugin_versioning
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_plugin_versioning base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_plugin_versioning-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_priority_queue:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_priority_queue
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_priority_queue base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_priority_queue-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_queue_consumers:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_queue_consumers
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_queue_consumers base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_queue_consumers-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_stats_and_metrics:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_stats_and_metrics
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_stats_and_metrics base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_stats_and_metrics-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_supervisor2:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_supervisor2
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_supervisor2 base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_supervisor2-logs
          path: "*-ct-logs-*.tar.xz"
  ct-unit_vm_memory_monitor:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-unit_vm_memory_monitor
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-unit_vm_memory_monitor base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-unit_vm_memory_monitor-logs
          path: "*-ct-logs-*.tar.xz"
  ct-vhost:
    needs: [checks]
    # https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#contexts
    name: ct-vhost
    runs-on: ubuntu-18.04
    steps:
      - name: CHECKOUT REPOSITORY
        uses: actions/checkout@v2
      # https://github.com/marketplace/actions/setup-elixir
      - name: CONFIGURE OTP & ELIXIR
        uses: actions/setup-elixir@v1
        with:
          otp-version: 22.3
          # https://github.com/elixir-lang/elixir/releases
          elixir-version: 1.10.2
      - name: CACHE DEPS
        uses: actions/cache@v1
        with:
          path: deps
          key: otp-22.3_git-${{ github.sha }}_deps
      - name: CACHE APP MODULES
        uses: actions/cache@v1
        with:
          path: ebin
          key: otp-22.3_git-${{ github.sha }}_ebin
      - name: RUN TESTS
        run: |
          branch_or_tag_name=${GITHUB_REF#refs/*/}
          touch ebin/* apps/rabbitmq_prelaunch/ebin/*
          make ct-vhost base_rmq_ref=master current_rmq_ref=$branch_or_tag_named FULL=
      - name: ON FAILURE ARCHIVE TESTS LOGS
        if: failure()
        run: |
          make ct-logs-archive
      - name: ON FAILURE UPLOAD TESTS LOGS ARTIFACT
        # https://github.com/marketplace/actions/upload-artifact
        uses: actions/upload-artifact@v2-preview
        if: failure()
        with:
          name: ct-vhost-logs
          path: "*-ct-logs-*.tar.xz"
